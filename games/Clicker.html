<!DOCTYPE html>
<html lang="fr-CA">
    <head>
        <title>Clicker Game</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <link rel="icon" href="../schooltoolicon.png" type="image/x-icon">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow-x: hidden;
            }

            #menu-btn {
                position: fixed;
                top: 20px;
                left: 20px;
                background: rgba(44, 62, 80, 0.95);
                backdrop-filter: blur(10px);
                color: white;
                border: none;
                padding: 12px 18px;
                border-radius: 12px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 1001;
                transition: all 0.3s ease;
            }

            #menu-btn:hover {
                background: rgba(31, 46, 58, 0.95);
                transform: translateY(-2px);
                box-shadow: 0 6px 25px rgba(0,0,0,0.4);
            }

            .top-buttons {
                position: fixed;
                top: 20px;
                right: 20px;
                display: flex;
                gap: 10px;
                z-index: 1001;
            }

            .top-btn {
                background: rgba(44, 62, 80, 0.95);
                backdrop-filter: blur(10px);
                color: white;
                border: none;
                padding: 12px 18px;
                border-radius: 12px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                transition: all 0.3s ease;
            }

            .top-btn:hover {
                background: rgba(31, 46, 58, 0.95);
                transform: translateY(-2px);
            }

            .game-container {
                display: flex;
                width: 100%;
                max-width: 1400px;
                padding: 20px;
                gap: 20px;
            }

            .main-section {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 20px;
                margin-top: 60px;
            }

            .stats-panel {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                padding: 30px;
                border-radius: 20px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                border: 1px solid rgba(255, 255, 255, 0.2);
                text-align: center;
                min-width: 400px;
            }

            #clickDisplay {
                font-size: 3rem;
                font-weight: bold;
                color: white;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                margin-bottom: 10px;
            }

            #cps {
                font-size: 1.5rem;
                color: #f39c12;
                font-weight: 600;
                text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }

            #clicksPerClickDisplay {
                font-size: 1.2rem;
                color: #2ecc71;
                font-weight: 600;
                margin-top: 10px;
                text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }

            #multiplierDisplay {
                font-size: 1.1rem;
                color: #e74c3c;
                font-weight: 600;
                margin-top: 5px;
                text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }

            #clickButton {
                width: 250px;
                height: 250px;
                border-radius: 50%;
                font-size: 4rem;
                background: linear-gradient(145deg, #3498db, #2980b9);
                color: white;
                border: none;
                cursor: pointer;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                transition: all 0.1s ease;
                position: relative;
                overflow: hidden;
            }

            #clickButton:hover {
                transform: scale(1.05);
                box-shadow: 0 15px 50px rgba(52, 152, 219, 0.5);
            }

            #clickButton:active {
                transform: scale(0.95);
            }

            #clickButton.golden {
                background: linear-gradient(145deg, #f39c12, #e67e22);
                animation: goldenPulse 1s infinite;
            }

            @keyframes goldenPulse {
                0%, 100% { box-shadow: 0 10px 40px rgba(243, 156, 18, 0.5); }
                50% { box-shadow: 0 15px 60px rgba(243, 156, 18, 0.8); }
            }

            .click-particle {
                position: fixed;
                font-size: 2rem;
                font-weight: bold;
                color: #f39c12;
                pointer-events: none;
                z-index: 9999;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
                animation: floatUp 1s ease-out forwards;
            }

            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(1.5);
                }
            }

            #buildingContainer {
                position: fixed;
                right: 20px;
                top: 50%;
                transform: translateY(-50%);
                width: 320px;
                max-height: 80vh;
                overflow-y: auto;
                padding: 20px;
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            }

            #buildingContainer::-webkit-scrollbar {
                width: 8px;
            }

            #buildingContainer::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
            }

            #buildingContainer::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 10px;
            }

            .building {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.8), rgba(41, 128, 185, 0.8));
                padding: 15px;
                margin-bottom: 12px;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.2s ease;
                border: 2px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                color: white;
            }

            .building:hover {
                transform: translateX(-5px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
                border-color: rgba(255, 255, 255, 0.4);
            }

            .building.clicked {
                transform: scale(0.95);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            }

            .building.disabled {
                background: linear-gradient(135deg, rgba(127, 140, 141, 0.6), rgba(95, 106, 106, 0.6));
                cursor: not-allowed;
                opacity: 0.6;
            }

            .building strong {
                display: block;
                font-size: 1.1rem;
                margin-bottom: 5px;
            }

            .building-details {
                font-size: 0.85rem;
                opacity: 0.9;
                margin-top: 5px;
            }

            .achievements-panel {
                position: fixed;
                left: 20px;
                top: 100px;
                width: 250px;
                max-height: 400px;
                overflow-y: auto;
                padding: 20px;
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            }

            .achievements-title {
                color: white;
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 15px;
                text-align: center;
            }

            .achievement {
                background: rgba(46, 204, 113, 0.2);
                padding: 10px;
                margin-bottom: 10px;
                border-radius: 8px;
                border-left: 4px solid #2ecc71;
                color: white;
            }

            .achievement.locked {
                background: rgba(127, 140, 141, 0.2);
                border-left-color: #7f8c8d;
                opacity: 0.5;
            }

            .achievement-name {
                font-weight: bold;
                margin-bottom: 3px;
            }

            .achievement-desc {
                font-size: 0.85rem;
                opacity: 0.8;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(5px);
                z-index: 10000;
                justify-content: center;
                align-items: center;
            }

            .modal.active {
                display: flex;
            }

            .modal-content {
                background: linear-gradient(135deg, rgba(44, 62, 80, 0.95), rgba(52, 73, 94, 0.95));
                padding: 40px;
                border-radius: 20px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                color: white;
            }

            .modal-title {
                font-size: 2rem;
                margin-bottom: 20px;
                text-align: center;
                color: #3498db;
            }

            .modal-close {
                float: right;
                font-size: 2rem;
                cursor: pointer;
                color: #e74c3c;
                transition: transform 0.2s;
            }

            .modal-close:hover {
                transform: scale(1.2);
            }

            .upgrade-item {
                background: rgba(52, 152, 219, 0.3);
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                border: 2px solid rgba(52, 152, 219, 0.5);
                cursor: pointer;
                transition: all 0.3s;
            }

            .upgrade-item:hover {
                background: rgba(52, 152, 219, 0.5);
                border-color: rgba(52, 152, 219, 0.8);
                transform: translateX(5px);
            }

            .upgrade-item.purchased {
                background: rgba(46, 204, 113, 0.3);
                border-color: rgba(46, 204, 113, 0.5);
                cursor: default;
                opacity: 0.6;
            }

            .upgrade-item.disabled {
                opacity: 0.4;
                cursor: not-allowed;
            }

            .upgrade-name {
                font-size: 1.3rem;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .upgrade-desc {
                font-size: 0.9rem;
                opacity: 0.9;
                margin-bottom: 5px;
            }

            .upgrade-cost {
                font-size: 1.1rem;
                color: #f39c12;
                font-weight: bold;
            }

            .prestige-info {
                background: rgba(155, 89, 182, 0.3);
                padding: 20px;
                border-radius: 15px;
                margin: 20px 0;
                border: 2px solid rgba(155, 89, 182, 0.5);
            }

            .prestige-btn {
                background: linear-gradient(135deg, #9b59b6, #8e44ad);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 10px;
                font-size: 1.2rem;
                font-weight: bold;
                cursor: pointer;
                width: 100%;
                margin-top: 15px;
                transition: all 0.3s;
            }

            .prestige-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 5px 20px rgba(155, 89, 182, 0.5);
            }

            .prestige-btn:disabled {
                background: gray;
                cursor: not-allowed;
                opacity: 0.5;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin: 20px 0;
            }

            .stat-box {
                background: rgba(255, 255, 255, 0.1);
                padding: 15px;
                border-radius: 10px;
                text-align: center;
            }

            .stat-label {
                font-size: 0.9rem;
                opacity: 0.8;
                margin-bottom: 5px;
            }

            .stat-value {
                font-size: 1.5rem;
                font-weight: bold;
                color: #3498db;
            }

            .golden-click-indicator {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(243, 156, 18, 0.9);
                color: white;
                padding: 15px 30px;
                border-radius: 10px;
                font-weight: bold;
                font-size: 1.2rem;
                box-shadow: 0 5px 20px rgba(243, 156, 18, 0.5);
                animation: bounce 0.5s infinite;
            }

            @keyframes bounce {
                0%, 100% { transform: translateX(-50%) translateY(0); }
                50% { transform: translateX(-50%) translateY(-10px); }
            }

            @media (max-width: 1200px) {
                .game-container {
                    flex-direction: column;
                }

                #buildingContainer {
                    position: relative;
                    right: auto;
                    top: auto;
                    transform: none;
                    width: 100%;
                    max-width: 500px;
                    margin: 20px auto;
                }

                .achievements-panel {
                    position: relative;
                    left: auto;
                    top: auto;
                    width: 100%;
                    max-width: 500px;
                    margin: 20px auto;
                }

                .stats-panel {
                    min-width: auto;
                    width: 100%;
                    max-width: 500px;
                }
            }

            @media (max-width: 768px) {
                #clickDisplay {
                    font-size: 2rem;
                }

                #clickButton {
                    width: 180px;
                    height: 180px;
                    font-size: 3rem;
                }

                .stats-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <button id="menu-btn" onmouseenter="mouseEnter('menu-btn')" onmouseleave="mouseLeave('menu-btn')"><i class="fas fa-bars"></i> Menu</button>

        <div class="top-buttons">
            <button class="top-btn" onclick="openUpgradesModal()"><i class="fas fa-arrow-up"></i> Upgrades</button>
            <button class="top-btn" onclick="openStatsModal()"><i class="fas fa-chart-bar"></i> Stats</button>
            <button class="top-btn" onclick="openPrestigeModal()"><i class="fas fa-crown"></i> Prestige</button>
        </div>

        <div class="game-container">
            <div class="achievements-panel">
                <div class="achievements-title">üèÜ Achievements</div>
                <div id="achievementsList"></div>
            </div>

            <div class="main-section">
                <div class="stats-panel">
                    <div id="clickDisplay">Clicks: 0</div>
                    <div id="cps">CPS: 0</div>
                    <div id="clicksPerClickDisplay">Per Click: 1</div>
                    <div id="multiplierDisplay"></div>
                </div>
                <button id="clickButton">üíé</button>
            </div>

            <div id="buildingContainer"></div>
        </div>

        <!-- Upgrades Modal -->
        <div id="upgradesModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal('upgradesModal')">&times;</span>
                <h2 class="modal-title">‚ö° Upgrades</h2>
                <div id="upgradesList"></div>
            </div>
        </div>

        <!-- Stats Modal -->
        <div id="statsModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal('statsModal')">&times;</span>
                <h2 class="modal-title">üìä Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Total Clicks</div>
                        <div class="stat-value" id="totalClicksStat">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Total Earned</div>
                        <div class="stat-value" id="totalEarnedStat">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Buildings Owned</div>
                        <div class="stat-value" id="totalBuildingsStat">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Upgrades Purchased</div>
                        <div class="stat-value" id="upgradesPurchasedStat">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Prestige Level</div>
                        <div class="stat-value" id="prestigeLevelStat">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Play Time</div>
                        <div class="stat-value" id="playTimeStat">0s</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prestige Modal -->
        <div id="prestigeModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal('prestigeModal')">&times;</span>
                <h2 class="modal-title">üëë Prestige</h2>
                <div class="prestige-info">
                    <p style="font-size: 1.2rem; margin-bottom: 15px;">
                        Prestige resets your progress but grants you powerful permanent bonuses!
                    </p>
                    <p style="font-size: 1.1rem; margin-bottom: 10px;">
                        Current Score: <span id="prestigeCurrentScore" style="color: #3498db; font-weight: bold;">0</span>
                    </p>
                    <p style="font-size: 1.1rem; margin-bottom: 10px;">
                        Prestige Points Earned: <span id="prestigePointsEarned" style="color: #9b59b6; font-weight: bold;">0</span>
                    </p>
                    <p style="font-size: 1.1rem;">
                        Current Prestige Multiplier: <span id="currentPrestigeMultiplier" style="color: #e74c3c; font-weight: bold;">1x</span>
                    </p>
                    <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">
                        Each prestige point gives +10% to all production. Required: 1 million clicks
                    </p>
                </div>
                <button class="prestige-btn" id="prestigeBtn" onclick="doPrestige()">
                    Prestige Now
                </button>
            </div>
        </div>
        <script src="/auth.js"></script>
        <script src="/menu.js"></script>
        <script>
            loadMenu();
        </script>
        <script>
            document.getElementById("menu-btn").addEventListener("click", function () {
                document.getElementById("menu").classList.toggle("open");
            });

            function mouseEnter(id) {
                const newId = document.getElementById(id);
                newId.classList.add('fa-bounce');
            }
                
            function mouseLeave(id) {
                const newId = document.getElementById(id);
                newId.classList.remove('fa-bounce');
            }
        </script>
        <script>
            const button = document.getElementById('clickButton');
            const clickDisplay = document.getElementById('clickDisplay');
            const cpsDisplay = document.getElementById('cps');
            const clicksPerClickDisplay = document.getElementById('clicksPerClickDisplay');
            const multiplierDisplay = document.getElementById('multiplierDisplay');

            const buildingList = [
                {
                    name: "Auto Clicker",
                    baseCost: 10,
                    cost: 10,
                    cpsAdded: 1,
                    clicksPerClickAdded: 0,
                    count: 0,
                    icon: "üñ±Ô∏è"
                },
                {
                    name: "Worker",
                    baseCost: 100,
                    cost: 100,
                    cpsAdded: 5,
                    clicksPerClickAdded: 1,
                    count: 0,
                    icon: "üë∑"
                },
                {
                    name: "Factory",
                    baseCost: 1000,
                    cost: 1000,
                    cpsAdded: 25,
                    clicksPerClickAdded: 2,
                    count: 0,
                    icon: "üè≠"
                },
                {
                    name: "Robot",
                    baseCost: 10000,
                    cost: 10000,
                    cpsAdded: 100,
                    clicksPerClickAdded: 5,
                    count: 0,
                    icon: "ü§ñ"
                },
                {
                    name: "AI System",
                    baseCost: 100000,
                    cost: 100000,
                    cpsAdded: 500,
                    clicksPerClickAdded: 15,
                    count: 0,
                    icon: "üß†"
                },
                {
                    name: "Quantum Computer",
                    baseCost: 1000000,
                    cost: 1000000,
                    cpsAdded: 2500,
                    clicksPerClickAdded: 50,
                    count: 0,
                    icon: "‚öõÔ∏è"
                }
            ];

            const upgrades = [
                { name: "Double Click", desc: "Double your click power", cost: 500, effect: () => { clickPowerMultiplier *= 2; }, purchased: false },
                { name: "Speed Boost I", desc: "+50% CPS", cost: 1000, effect: () => { cpsMultiplier += 0.5; }, purchased: false },
                { name: "Mega Clicks", desc: "+100 clicks per click", cost: 5000, effect: () => { clicksPerClick += 100; }, purchased: false },
                { name: "Speed Boost II", desc: "+100% CPS", cost: 10000, effect: () => { cpsMultiplier += 1; }, purchased: false },
                { name: "Golden Touch", desc: "10% chance for 10x clicks", cost: 25000, effect: () => { goldenClickChance = 0.1; }, purchased: false },
                { name: "Triple Power", desc: "Triple your click power", cost: 50000, effect: () => { clickPowerMultiplier *= 3; }, purchased: false },
                { name: "Speed Boost III", desc: "+200% CPS", cost: 100000, effect: () => { cpsMultiplier += 2; }, purchased: false },
                { name: "Super Clicker", desc: "+500 clicks per click", cost: 250000, effect: () => { clicksPerClick += 500; }, purchased: false }
            ];

            const achievements = [
                { name: "First Click", desc: "Click once", condition: () => totalClicks >= 1, unlocked: false },
                { name: "Getting Started", desc: "Reach 100 clicks", condition: () => score >= 100, unlocked: false },
                { name: "Thousand Club", desc: "Reach 1,000 clicks", condition: () => score >= 1000, unlocked: false },
                { name: "First Purchase", desc: "Buy your first building", condition: () => totalBuildings >= 1, unlocked: false },
                { name: "Production Line", desc: "Own 10 buildings", condition: () => totalBuildings >= 10, unlocked: false },
                { name: "Automation", desc: "Reach 100 CPS", condition: () => cps >= 100, unlocked: false },
                { name: "Click Master", desc: "Click 1000 times", condition: () => totalClicks >= 1000, unlocked: false },
                { name: "Millionaire", desc: "Reach 1 million clicks", condition: () => totalEarned >= 1000000, unlocked: false },
                { name: "First Upgrade", desc: "Purchase an upgrade", condition: () => upgradesPurchased >= 1, unlocked: false },
                { name: "Speed Demon", desc: "Reach 1000 CPS", condition: () => cps >= 1000, unlocked: false },
                { name: "Factory Owner", desc: "Own 50 buildings", condition: () => totalBuildings >= 50, unlocked: false },
                { name: "Ascension", desc: "Prestige for the first time", condition: () => prestigeLevel >= 1, unlocked: false }
            ];

            let score = 0;
            let cps = 0;
            let clicksPerClick = 1;
            let totalClicks = 0;
            let totalBuildings = 0;
            let totalEarned = 0;
            let upgradesPurchased = 0;
            let prestigeLevel = 0;
            let prestigePoints = 0;
            let playTime = 0;
            let clickPowerMultiplier = 1;
            let cpsMultiplier = 1;
            let goldenClickChance = 0;
            let goldenClickActive = false;
            let goldenClickTimeout = null;

            button.addEventListener("click", function(e) {
                let clickValue = clicksPerClick * clickPowerMultiplier * (1 + prestigePoints * 0.1);
                
                // Golden click chance
                if (goldenClickChance > 0 && Math.random() < goldenClickChance) {
                    clickValue *= 10;
                    activateGoldenClick();
                }
                
                score += clickValue;
                totalClicks++;
                totalEarned += clickValue;
                
                createClickParticle(e.clientX, e.clientY, `+${formatNombre(Math.floor(clickValue))}`);
                
                updateScore();
                checkAchievements();
            });

            function activateGoldenClick() {
                goldenClickActive = true;
                button.classList.add('golden');
                
                const indicator = document.createElement('div');
                indicator.className = 'golden-click-indicator';
                indicator.textContent = '‚≠ê GOLDEN CLICK! 10x ‚≠ê';
                document.body.appendChild(indicator);
                
                if (goldenClickTimeout) clearTimeout(goldenClickTimeout);
                
                goldenClickTimeout = setTimeout(() => {
                    button.classList.remove('golden');
                    goldenClickActive = false;
                    indicator.remove();
                }, 2000);
            }

            function createClickParticle(x, y, text) {
                const particle = document.createElement('div');
                particle.className = 'click-particle';
                particle.textContent = text;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                if (goldenClickActive) {
                    particle.style.color = '#f39c12';
                    particle.style.fontSize = '2.5rem';
                }
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }

            buildingList.forEach(function(buildingData) {
                const buildingContainer = document.getElementById('buildingContainer');
                const building = document.createElement('div');

                building.innerHTML = `
                    <strong>${buildingData.icon} ${buildingData.name}</strong>
                    <div class="building-details">
                        Cost: ${formatNombre(buildingData.cost)} | Owned: ${buildingData.count}
                        <br>+${buildingData.cpsAdded} CPS | +${buildingData.clicksPerClickAdded} per click
                    </div>
                `;

                buildingContainer.appendChild(building);
                building.className = "building disabled";
                building.dataset.building = buildingData.name;

                building.onclick = () => {
                    building.classList.add("clicked");
                    setTimeout(() => {
                        building.classList.remove("clicked");
                    }, 100);

                    buildingBought(buildingData, building);
                };
            });

            function buildingBought(building, buildingElement) {
                if (building.cost > score) {
                    return;
                }
                
                score -= building.cost;
                cps += building.cpsAdded;
                clicksPerClick += building.clicksPerClickAdded;
                building.count += 1;
                totalBuildings++;
                
                building.cost = Math.floor(building.baseCost * Math.pow(1.15, building.count));

                buildingElement.innerHTML = `
                    <strong>${building.icon} ${building.name}</strong>
                    <div class="building-details">
                        Cost: ${formatNombre(building.cost)} | Owned: ${building.count}
                        <br>+${building.cpsAdded} CPS | +${building.clicksPerClickAdded} per click
                    </div>
                `;

                updateCps();
                updateScore();
                updateBuildingStates();
                checkAchievements();
            }

            function updateBuildingStates() {
                document.querySelectorAll('.building').forEach(buildingEl => {
                    const buildingName = buildingEl.dataset.building;
                    const building = buildingList.find(b => b.name === buildingName);
                    
                    if (building && building.cost <= score) {
                        buildingEl.classList.remove('disabled');
                    } else {
                        buildingEl.classList.add('disabled');
                    }
                });
            }

            function updateScore() {
                if (isNaN(score)) {
                    console.warn("Score is NaN, resetting to 0");
                    score = 0;
                }

                clickDisplay.innerHTML = `Clicks: ${formatNombre(Math.floor(score))}`;
                updateBuildingStates();
            }

            function updateCps() {
                const effectiveCps = cps * cpsMultiplier * (1 + prestigePoints * 0.1);
                cpsDisplay.innerHTML = `CPS: ${formatNombre(Math.floor(effectiveCps))}`;
                clicksPerClickDisplay.innerHTML = `Per Click: ${formatNombre(Math.floor(clicksPerClick * clickPowerMultiplier * (1 + prestigePoints * 0.1)))}`;
                
                if (prestigePoints > 0) {
                    multiplierDisplay.innerHTML = `Prestige Bonus: +${(prestigePoints * 10)}%`;
                }
            }

            function updateScorePerSecond() {
                const effectiveCps = cps * cpsMultiplier * (1 + prestigePoints * 0.1);
                score += effectiveCps;
                totalEarned += effectiveCps;
                updateScore();
            }

            function formatNombre(n) {
                if (n >= 1e15) return (n / 1e15).toPrecision(3) + "Q";
                if (n >= 1e12) return (n / 1e12).toPrecision(3) + "T";
                if (n >= 1e9)  return (n / 1e9).toPrecision(3) + "B";
                if (n >= 1e6)  return (n / 1e6).toPrecision(3) + "M";
                if (n >= 1e3)  return (n / 1e3).toPrecision(3) + "K";
                return Math.floor(n);
            }

            function checkAchievements() {
                const achievementsList = document.getElementById('achievementsList');
                let updated = false;

                achievements.forEach(achievement => {
                    if (!achievement.unlocked && achievement.condition()) {
                        achievement.unlocked = true;
                        updated = true;
                        showAchievementNotification(achievement.name);
                    }
                });

                if (updated) {
                    renderAchievements();
                }
            }

            function renderAchievements() {
                const achievementsList = document.getElementById('achievementsList');
                achievementsList.innerHTML = '';

                achievements.forEach(achievement => {
                    const div = document.createElement('div');
                    div.className = achievement.unlocked ? 'achievement' : 'achievement locked';
                    div.innerHTML = `
                        <div class="achievement-name">${achievement.unlocked ? '‚úì' : 'üîí'} ${achievement.name}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                    `;
                    achievementsList.appendChild(div);
                });
            }

            function showAchievementNotification(name) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(46, 204, 113, 0.95);
                    color: white;
                    padding: 30px 50px;
                    border-radius: 15px;
                    font-size: 1.5rem;
                    font-weight: bold;
                    z-index: 10000;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                    animation: achievementPop 3s ease-out forwards;
                `;
                notification.innerHTML = `üèÜ Achievement Unlocked!<br>${name}`;
                document.body.appendChild(notification);

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes achievementPop {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                        10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                        20% { transform: translate(-50%, -50%) scale(1); }
                        80% { opacity: 1; }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    }
                `;
                document.head.appendChild(style);

                setTimeout(() => {
                    notification.remove();
                    style.remove();
                }, 3000);
            }

            function openUpgradesModal() {
                document.getElementById('upgradesModal').classList.add('active');
                renderUpgrades();
            }

            function openStatsModal() {
                document.getElementById('statsModal').classList.add('active');
                updateStatsDisplay();
            }

            function openPrestigeModal() {
                document.getElementById('prestigeModal').classList.add('active');
                updatePrestigeDisplay();
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            function renderUpgrades() {
                const upgradesList = document.getElementById('upgradesList');
                upgradesList.innerHTML = '';

                upgrades.forEach((upgrade, index) => {
                    const div = document.createElement('div');
                    const canAfford = upgrade.cost <= score;
                    const classes = ['upgrade-item'];
                    
                    if (upgrade.purchased) classes.push('purchased');
                    else if (!canAfford) classes.push('disabled');
                    
                    div.className = classes.join(' ');
                    
                    div.innerHTML = `
                        <div class="upgrade-name">${upgrade.purchased ? '‚úì ' : ''}${upgrade.name}</div>
                        <div class="upgrade-desc">${upgrade.desc}</div>
                        <div class="upgrade-cost">${upgrade.purchased ? 'PURCHASED' : 'Cost: ' + formatNombre(upgrade.cost)}</div>
                    `;
                    
                    if (!upgrade.purchased) {
                        div.onclick = () => buyUpgrade(index);
                    }
                    
                    upgradesList.appendChild(div);
                });
            }

            function buyUpgrade(index) {
                const upgrade = upgrades[index];
                
                if (upgrade.purchased || upgrade.cost > score) {
                    return;
                }
                
                score -= upgrade.cost;
                upgrade.purchased = true;
                upgrade.effect();
                upgradesPurchased++;
                
                updateScore();
                updateCps();
                renderUpgrades();
                checkAchievements();
            }

            function updateStatsDisplay() {
                document.getElementById('totalClicksStat').textContent = formatNombre(totalClicks);
                document.getElementById('totalEarnedStat').textContent = formatNombre(Math.floor(totalEarned));
                document.getElementById('totalBuildingsStat').textContent = totalBuildings;
                document.getElementById('upgradesPurchasedStat').textContent = upgradesPurchased;
                document.getElementById('prestigeLevelStat').textContent = prestigeLevel;
                
                const minutes = Math.floor(playTime / 60);
                const seconds = playTime % 60;
                document.getElementById('playTimeStat').textContent = `${minutes}m ${seconds}s`;
            }

            function updatePrestigeDisplay() {
                const pointsEarned = Math.floor(totalEarned / 1000000);
                document.getElementById('prestigeCurrentScore').textContent = formatNombre(Math.floor(score));
                document.getElementById('prestigePointsEarned').textContent = pointsEarned;
                document.getElementById('currentPrestigeMultiplier').textContent = (1 + prestigePoints * 0.1).toFixed(1) + 'x';
                
                const btn = document.getElementById('prestigeBtn');
                if (totalEarned >= 1000000) {
                    btn.disabled = false;
                    btn.textContent = `Prestige Now (+${pointsEarned} points)`;
                } else {
                    btn.disabled = true;
                    btn.textContent = `Need ${formatNombre(1000000 - Math.floor(totalEarned))} more clicks`;
                }
            }

            function doPrestige() {
                if (totalEarned < 1000000) return;
                
                const pointsEarned = Math.floor(totalEarned / 1000000);
                prestigePoints += pointsEarned;
                prestigeLevel++;
                
                // Reset game state
                score = 0;
                cps = 0;
                clicksPerClick = 1;
                totalClicks = 0;
                totalBuildings = 0;
                totalEarned = 0;
                upgradesPurchased = 0;
                clickPowerMultiplier = 1;
                cpsMultiplier = 1;
                goldenClickChance = 0;
                
                // Reset buildings
                buildingList.forEach(b => {
                    b.count = 0;
                    b.cost = b.baseCost;
                });
                
                // Reset upgrades
                upgrades.forEach(u => u.purchased = false);
                
                // Rebuild UI
                document.getElementById('buildingContainer').innerHTML = '';
                buildingList.forEach(function(buildingData) {
                    const buildingContainer = document.getElementById('buildingContainer');
                    const building = document.createElement('div');

                    building.innerHTML = `
                        <strong>${buildingData.icon} ${buildingData.name}</strong>
                        <div class="building-details">
                            Cost: ${formatNombre(buildingData.cost)} | Owned: ${buildingData.count}
                            <br>+${buildingData.cpsAdded} CPS | +${buildingData.clicksPerClickAdded} per click
                        </div>
                    `;

                    buildingContainer.appendChild(building);
                    building.className = "building disabled";
                    building.dataset.building = buildingData.name;

                    building.onclick = () => {
                        building.classList.add("clicked");
                        setTimeout(() => building.classList.remove("clicked"), 100);
                        buildingBought(buildingData, building);
                    };
                });
                
                updateScore();
                updateCps();
                checkAchievements();
                closeModal('prestigeModal');
                
                showAchievementNotification(`Prestige Level ${prestigeLevel}!`);
            }

            // Auto-save
            function saveGame() {
                const gameState = {
                    score, cps, clicksPerClick, totalClicks, totalBuildings,
                    totalEarned, upgradesPurchased, prestigeLevel, prestigePoints,
                    playTime, clickPowerMultiplier, cpsMultiplier, goldenClickChance,
                    buildings: buildingList.map(b => ({ count: b.count, cost: b.cost })),
                    upgrades: upgrades.map(u => ({ purchased: u.purchased })),
                    achievements: achievements.map(a => ({ unlocked: a.unlocked }))
                };
                localStorage.setItem('clickerGameSave', JSON.stringify(gameState));
            }

            function loadGame() {
                const saved = localStorage.getItem('clickerGameSave');
                if (!saved) return;
                
                try {
                    const state = JSON.parse(saved);
                    score = state.score || 0;
                    cps = state.cps || 0;
                    clicksPerClick = state.clicksPerClick || 1;
                    totalClicks = state.totalClicks || 0;
                    totalBuildings = state.totalBuildings || 0;
                    totalEarned = state.totalEarned || 0;
                    upgradesPurchased = state.upgradesPurchased || 0;
                    prestigeLevel = state.prestigeLevel || 0;
                    prestigePoints = state.prestigePoints || 0;
                    playTime = state.playTime || 0;
                    clickPowerMultiplier = state.clickPowerMultiplier || 1;
                    cpsMultiplier = state.cpsMultiplier || 1;
                    goldenClickChance = state.goldenClickChance || 0;
                    
                    if (state.buildings) {
                        state.buildings.forEach((b, i) => {
                            if (buildingList[i]) {
                                buildingList[i].count = b.count;
                                buildingList[i].cost = b.cost;
                            }
                        });
                    }
                    
                    if (state.upgrades) {
                        state.upgrades.forEach((u, i) => {
                            if (upgrades[i]) {
                                upgrades[i].purchased = u.purchased;
                                if (u.purchased) upgrades[i].effect();
                            }
                        });
                    }
                    
                    if (state.achievements) {
                        state.achievements.forEach((a, i) => {
                            if (achievements[i]) {
                                achievements[i].unlocked = a.unlocked;
                            }
                        });
                    }
                    
                    updateScore();
                    updateCps();
                    renderAchievements();
                } catch (e) {
                    console.error('Failed to load game:', e);
                }
            }

            // Initialize
            loadGame();
            renderAchievements();
            setInterval(updateScorePerSecond, 1000);
            setInterval(checkAchievements, 1000);
            setInterval(saveGame, 5000);
            setInterval(() => { playTime++; }, 1000);

            // Close modals on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        </script>
    </body>
</html>